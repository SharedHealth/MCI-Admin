{% extends 'base.html.twig' %}

{% block content %}

    <div class="row">
        <div class="col-lg-12">
            <h3 class="page-header">Search Patient</h3>
        </div>
      <span class="systeError" style="color: red;">{{ systemError }}</span>
        <!-- /.col-lg-12 -->
    </div>
    <div style="display: none;" class="fillOne error">Please fill at least one field</div>
    <div style="display: none;" class="selectlocation error">Please select division and district and upazilla </div>
    <!-- /.row -->
    <form id="searchPatientForm" name="searchPatient"  method="get">

        <h5>IDs:</h5>

        <div class="row">
            <div class="col-lg-3" >
                <div class="form-group">
                    <input id="nid" name="nid" class="form-control " value="{% if queryparam.nid is defined  %}{{ queryparam.nid|trim }}{% endif %}"  placeholder="NID">
                </div>
            </div>
            <div class="col-lg-3 ">
                <div class="form-group group-error-block">
                    <input id="brn" name="brn" class="form-control " value="{% if queryparam.bin_brn is defined  %}{{ queryparam.bin_brn|trim }}{% endif %}" placeholder="BRN">
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group group-error-block">
                    <input id="uid" name="uid" class="form-control " value="{% if queryparam.uid is defined  %}{{ queryparam.uid|trim }}{% endif %}" placeholder="UID">
                </div>
            </div>

        </div>

        <h5>Personal Details:</h5>
        <div class="row">
            <div class="col-lg-3">
                <div class="form-group">
                    <input id="given_name" name="given_name" value ="{% if queryparam.given_name is defined  %}{{ queryparam.given_name|trim }}{% endif %}" class="form-control" placeholder="Given Name">
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group">
                    <input id="sur_name" name="sur_name" value ="{% if queryparam.sur_name is defined  %}{{ queryparam.sur_name|trim }}{% endif %}" class="form-control" placeholder="Surname">
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group">
                    <input id="dob" name="dob" value ="{% if queryparam.date_of_birth is defined  %}{{ queryparam.date_of_birth|trim }}{% endif %}" class="form-control" placeholder="Date of Birth">
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-lg-3">
                <div class="form-group">

                    <select name="division_id" id="division" class="form-control" >
                        <option value="">Select Division</option>
                        {% for division in divisions  %}

                            <option data-id="{{ division.id }}"  value="{{ division.code }}"
                                    {% if seletedDropdown.division is defined %}

                                    {% if division.code == seletedDropdown.division %} {{ "selected" }} {% endif %}
                                    {% endif %}
                                    >{{ division.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="form-group">
                    <select name="district_id" id="district" class="form-control" {% if seletedDropdown.district is null%} disabled="disabled" {% endif %} >
                        <option value="">Select District</option>
                        {% for district in districts  %}

                            <option data-id="{{ district.id }}"  value="{{ district.code }}"
                                    {% if seletedDropdown.district is defined %}

                                        {% if district.code == seletedDropdown.district %} {{ "selected" }} {% endif %}
                                    {% endif %}
                                    >{{ district.name }}</option>
                        {% endfor %}
                    </select>
                     <span class="districtloader" style="float: right;display: none"><img src="/assets/images/ajax-loader.gif"></span>
                </div>

            </div>
            <div class="col-lg-3">
                <div class="form-group">
                       <select name="upazilla_id" id="upazilla" class="form-control" {% if seletedDropdown.district is null%} disabled="disabled" {% endif %} >
                        <option value="">Select Upazilla</option>
                        {% for upazilla in upazillas  %}

                            <option data-id="{{ upazilla.id }}"  value="{{ upazilla.code }}"
                                    {% if seletedDropdown.upazilla is defined %}

                                        {% if upazilla.code == seletedDropdown.upazilla %} {{ "selected" }} {% endif %}
                                    {% endif %}
                                    >{{ upazilla.name }}</option>
                        {% endfor %}
                    </select>
                    <span class="upazillaloader" style="float: right; display: none"><img src="/assets/images/ajax-loader.gif"></span>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-lg-12">
                <button id="searchButton" type="button" class="btn btn-primary">Submit</button>
            </div>
        </div>
    </form>


   <hr/>
{% if responseBody.results is defined %}
    <h4>Search Results:</h4>

    {% if responseBody.additional_info.note is defined and responseBody.additional_info.note is not empty  %}
        <p>{{ responseBody.additional_info.note }}</p>
   {% endif %}

    <table class="table table-striped table-bordered table-hover dataTable" id="search-results">
        <thead>
        <tr>
            <th>HID</th>
            <th>NID</th>
            <th>Given Name</th>
            <th>Surname</th>
            <th>DOB</th>
            <th>Address</th>
            <th>Contact Number</th>
        </tr>
        </thead>
        <tbody>
        {% for result in responseBody.results  %}

            <tr>
                <td><a href="{{ path('mci_patient_showpage',{ 'id': result.hid }) }}">{{ result.hid }}</a></td>
                <td>{% if result.nid is defined %}{{ result.nid }}{% endif %}</td>
                <td>{{ result.given_name }}</td>
                <td>{{ result.sur_name }}</td>
                <td>{{ result.date_of_birth }}</td>
                <td>{{ result.present_address.address_line }}</td>
                <td> {% if result.primary_contact_number.number is defined %}{{ result.primary_contact_number.number }}{% endif %}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endif %}
{% include 'MciPatientBundle:Patient:searchJs.html.twig' %}
{% endblock %}
